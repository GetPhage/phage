<div class='card'>
  <div class='card-header'>
    <h1 class='card-title'><%= @device.friendly_name %></h1>
  </div>

  <% if @device.is_mobile %>
  <span class="badge badge-pill badge-primary">Mobile</span>
  <% end %>
  <% if @device.is_thing %>
  <span class="badge badge-pill badge-primary">Thing</span>
  <% end %>
  
  <ul>
    <li><%= @device.name.join(', ') %></li>
    <li><%= @device.ipv4.map(&:to_s).join(', ') %></li>
    <li><%= @device.mac_address %></li>
    <li><%= @device.try(:product).try(:name) %></li>
    <li><%= @device.product.try(:manufacturer).try(:name) %></li>
    <li><%=distance_of_time_in_words(@device.last_seen, Time.now, include_seconds: true) %> ago</li>
  </ul>



  <%= @device.tcpv4.join(', ') %>
 

  <h2>Flows</h2>
<p>
  <ul>
    <% Flow.where(device: @device).limit(10).order(id: :desc).each do |flow| %>
    <li>
      <%       begin
          src_port = Socket.getservbyport(flow.src_port)
        rescue
          src_port = flow.src_port.to_s
        end

        begin
          dst_port = Socket.getservbyport(flow.dst_port)
        rescue
          dst_port = flow.dst_port.to_s
               end
	       %>

      <%= flow.src_ip %>:<%= src_port %> -> <%= flow.dst_ip %>:<%=dst_port %><br/> <%= flow.bytes_sent %> bytes in <%= flow.duration %> seconds
    </li>
    <% end %>
  </ul>
</p>
<%
#  (bins, freq) = Flow.where(device: @device).pluck(:bytes_sent).histogram([0, 10, 100, 1000, 10000, 100000, 1000000]) 
  (bins, freq) = Flow.where(device: @device).pluck(:bytes_sent).histogram
  str_bins = bins.map do |bin|  number_with_precision(bin, :precision => 0, :delimiter => ',') end
  data = Hash[str_bins.zip(freq)]
  %>
<%= column_chart data %>

<%= link_to 'Edit', edit_device_path(@device) %> |
<%= link_to 'Back', devices_path %>

<% content_for :title, @device.name.first || @device.ipv4.first %>
